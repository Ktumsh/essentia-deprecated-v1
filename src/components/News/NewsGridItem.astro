---
import Clock from "@/icons/clock.astro";
import Eye from "@/icons/eye.astro";

interface Props {
  class?: string;
  topic?: string;
  title: string;
  imageAuthor?: string;
  author?: string;
  date?: string;
  views?: number;
  url?: string;
  image: string;
}

const {
  class: className,
  topic,
  title,
  imageAuthor,
  author,
  date,
  views,
  url = "#",
  image,
} = Astro.props;

function formatDate(apiDate?: string): string {
  const defaultDate = "01 jun 2024";
  if (!apiDate) return defaultDate;
  const dateObj = new Date(apiDate);
  const options: Intl.DateTimeFormatOptions = {
    day: "2-digit",
    month: "long",
    year: "numeric",
  };

  const formattedDate = dateObj.toLocaleDateString("es-ES", options);

  const parts = formattedDate.split(" ");
  if (parts.length >= 3) {
    const day = parts[0];
    const month = parts[2];
    const year = parts[4] || parts[2];

    const monthCapitalized = month.charAt(0).toUpperCase() + month.slice(1);

    return `${day} de ${monthCapitalized}, ${year}`;
  }
  return formattedDate;
}

const formattedDate = formatDate(date);
---

<a
  href={url}
  class={`
  ${className}
  group col-span-7 
  relative flex flex-col 
  items-center justify-end 
  h-96 rounded-xl shadow-md 
  overflow-hidden`}
>
  <img
    class="absolute inset-0 size-full object-cover group-hover:scale-105 transition"
    src={image}
    alt=""
  />
  <div
    class="absolute inset-0 size-full bg-cover bg-center bg-[linear-gradient(to_top,_rgba(0,_0,_0,_0.95)_0%,_transparent_100%)]"
  >
  </div>
  <div class="flex flex-col content-center p-10">
    <div
      class="flex flex-col items-start justify-start w-full mb-8 gap-2 text-white/80 z-10"
    >
      <span
        class="text-white/80 text-xs uppercase px-3 py-1 bg-bittersweet-500/40 dark:bg-cerise-red-600/40 backdrop-blur backdrop-saturate-150 border border-bittersweet-400/30 dark:border-cerise-red-600/30 overflow-hidden rounded-full shadow-md"
        >{topic}
      </span>
      <h4
        class="font-medium text-2xl group-hover:text-white text-ellipsis line-clamp-3 transition"
      >
        {title}
      </h4>
    </div>
    <div
      class="flex flex-row items-center w-full gap-5 text-base-color-dark z-10"
    >
      <div class="flex flex-row items-center gap-5 h-full w-full">
        <div class="flex flex-row items-center justify-center h-full gap-2">
          <img class="size-6 rounded-full" src={imageAuthor} alt="" />
          <span class="text-xs text-nowrap">{author}</span>
        </div>
        <div class="flex flex-row items-center justify-center h-full gap-2">
          <Clock
            width="14"
            height="14"
            class="text-bittersweet-400 dark:text-cerise-red-500"
          />
          <span class="text-xs text-nowrap">{formattedDate}</span>
        </div>
        <div class="flex flex-row items-center justify-center h-full gap-2">
          <Eye
            width="14"
            height="14"
            class="text-bittersweet-400 dark:text-cerise-red-500"
          />
          <span class="text-xs text-nowrap">{views}</span>
        </div>
      </div>
    </div>
  </div>
</a>
